<!DOCTYPE html>
<html>
	<meta charset='UTF-8'>
	<title>PrioList</title>
	<link href="Priority_list.css" rel="stylesheet" type="text/css">
<body> 
	<table class="sortable-table" id="rootTable">
	<thead>
		<tr>
			<th>Проект</th>
			<th>Описание задачи</th>
			<th></th>
		</tr>
	</thead>
	<tbody id="tMainBody">
		<tr>
			<td>Проект_1</td>
			<td>Описание_1</td>
			<td><button id = "check"><img src="resources/Check_mark.png"></button><button id = "edit"><img src="resources/Edit.png"></button></td>
		</tr>
		<tr>
			<td>Проект_2</td>
			<td>Описание_2</td>
			<td><button id = "check"><img src="resources/Check_mark.png"></button><button id = "edit"><img src="resources/Edit.png"></button></td>
		</tr>
	</tbody>
	</table>
	<div class="elements">
		<ul>
		<li><button id = "addRow"><img src="resources/Add.png"></button></li>
		<li><button id = "addRow"><img src="resources/Waiting.png"></button></li>
		<li><button id = "settings"><img src="resources/Settings.png"></button></li>
		<li><button id = "save"><img src="resources/Save.png"></button></li>
		</ul>

	</div><div>

	<table class="added-table" id="addTable">
		<tbody id="addtbody">
		</tbody>
	</table>

	<script type="text/javascript">
		var isAdd = false; 
		document.getElementById("addRow").onclick = function() {
			if (!isAdd) {
				var tbody = document.getElementById('addtbody');
			    var row = document.createElement("tr");
			    var td1 = document.createElement("td");
			    var td2 = document.createElement("td");
			    var td3 = document.createElement("td");

			    var input_progect = document.createElement('TEXTAREA');
			    td1.appendChild(input_progect);

			    var input_description = document.createElement('TEXTAREA');
			    td2.appendChild(input_description);

			    btn_check = document.createElement('button');
			    btn_check.id = 'add';
			    btn_check.addEventListener('click', function() {
				    AddMaintbl(input_progect.value, input_description.value);
				    var a = this.closest('tr');
				    a.parentElement.removeChild(a);
				    isAdd = false;
				  });
			    btn_check.innerHTML = '<img src="resources/Check_mark_add.png" />';
			    td3.appendChild(btn_check);

			    btn_waiting = document.createElement('button');
			    btn_waiting.id = 'wait';
			    btn_waiting.addEventListener('click', function() {
				    var a = this.closest('tr');
				    a.parentElement.removeChild(a);
				    isAdd = false;
				  });
			    btn_waiting.innerHTML = '<img src="resources/Close.png" />';
			    td3.appendChild(btn_waiting);

			    row.appendChild(td1);
			    row.appendChild(td2);
			    row.appendChild(td3);
			    tbody.appendChild(row);
			    isAdd = true;
			}
		}
		function AddMaintbl(input_progect, input_description) {
			var tbody = document.getElementById('tMainBody');
		    var row = document.createElement("tr");
		    var td1 = document.createElement("td");
		    td1.appendChild(document.createTextNode(input_progect));
		    var td2 = document.createElement("td");
		    td2.appendChild(document.createTextNode(input_description));
		    var td3 = document.createElement("td");

		    btn_waiting = document.createElement('button');
		    btn_waiting.id = 'check';
		    btn_waiting.innerHTML = '<img src="resources/Check_mark.png" />';
		    td3.appendChild(btn_waiting);

		    btn_check = document.createElement('button');
		    btn_check.id = 'edit';
		    btn_check.innerHTML = '<img src="resources/Edit.png" />';
		    td3.appendChild(btn_check);

		    row.appendChild(td1);
		    row.appendChild(td2);
		    row.appendChild(td3);
		    tbody.appendChild(row);
		}
		document.getElementById("save").onclick = function() {
			let result = [];
			let table = document.getElementById("tMainBody").getElementsByTagName("tbody")[0];
			let trs = table.getElementsByTagName("tr");
			for (let i = 2; i < trs.length; i++) {
			    let tds = trs[i].getElementsByTagName("td");
			    let obj = {};
			      obj.name = tds[0].innerHTML;
			      obj.rank = tds[1].innerHTML;
			      obj.phone = tds[2].innerHTML;
			      result.push(obj);
		  	}
		  	return JSON.stringify(result);
		}
	</script>	
	<script src="https://snipp.ru/cdn/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://snipp.ru/cdn/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script>
	var fixHelper = function(e, ui) {
		ui.children().each(function() {
			$(this).width($(this).width());
		});
		return ui;
	};	

	$('.sortable-table tbody').sortable({
		helper: fixHelper
	});
	</script>
</body>
</html>